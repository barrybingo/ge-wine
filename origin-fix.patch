From 20b17a86b09f8ca6f90ec4c4bc46b58599d97e33 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Bernhard=20=C3=9Cbelacker?= <bernhardu@mailbox.org>
Date: Wed, 8 Nov 2017 14:41:08 +0100
Subject: user32: Let nulldrv return some dummy monitor informations
Reply-To: wine-devel <wine-devel@winehq.org>

Bug: 43187
---
 dlls/user32/driver.c | 15 +++++++++++++--
 1 file changed, 13 insertions(+), 2 deletions(-)

diff --git a/dlls/user32/driver.c b/dlls/user32/driver.c
index 33bc2238de..f4da26f4a6 100644
--- a/dlls/user32/driver.c
+++ b/dlls/user32/driver.c
@@ -356,7 +356,10 @@ static LONG CDECL nulldrv_ChangeDisplaySettingsEx( LPCWSTR name, LPDEVMODEW mode
 
 static BOOL CDECL nulldrv_EnumDisplayMonitors( HDC hdc, LPRECT rect, MONITORENUMPROC proc, LPARAM lp )
 {
-    return FALSE;
+    RECT r = {0, 0, 640, 480};
+    TRACE("(%p, %p, %p, 0x%lx)\n", hdc, rect, proc, lp);
+    proc(NULL/*monitor*/, NULL/*hdc*/, &r, lp);
+    return TRUE;
 }
 
 static BOOL CDECL nulldrv_EnumDisplaySettingsEx( LPCWSTR name, DWORD num, LPDEVMODEW mode, DWORD flags )
@@ -366,7 +369,15 @@ static BOOL CDECL nulldrv_EnumDisplaySettingsEx( LPCWSTR name, DWORD num, LPDEVM
 
 static BOOL CDECL nulldrv_GetMonitorInfo( HMONITOR handle, LPMONITORINFO info )
 {
-    return FALSE;
+    RECT r = {0, 0, 640, 480};
+    const WCHAR device[] = {'n','u','l','l','d','r','v','_','m','o','n','i','t','o','r',0};
+    TRACE("(%p, %p)\n", handle, info);
+    info->rcMonitor = r;
+    info->rcWork = r;
+    info->dwFlags = MONITORINFOF_PRIMARY;
+    if (info->cbSize >= sizeof(MONITORINFOEXW))
+        lstrcpyW( ((MONITORINFOEXW *)info)->szDevice, device );
+    return TRUE;
 }
 
 static BOOL CDECL nulldrv_CreateDesktopWindow( HWND hwnd )
-- 
2.11.0
 
